<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ficha RPG</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
body{
  background:#0f172a;
  color:#e5e7eb;
  font-family:Arial, sans-serif;
  margin:0;
}

header{
  background:#1f2937;
  padding:12px 18px;
  font-size:18px;
  font-weight:bold;
  text-align:center;
}

.tabs{
  display:flex;
  justify-content:center;
  gap:8px;
  padding:12px;
  flex-wrap:wrap;
}

.tab-btn{
  padding:8px 14px;
  border-radius:10px;
  border:1px solid #374151;
  background:#020617;
  color:#e5e7eb;
  cursor:pointer;
}

.tab-btn.active{
  background:#4f46e5;
  border-color:#4f46e5;
}

.section{
  max-width:900px;
  margin:0 auto;
  padding:14px;
  display:none;
}

.section.active{ display:block; }

.bloco{
  background:#1f2937;
  padding:14px;
  border-radius:14px;
  margin:12px 0;
}

h2{
  margin-top:0;
  color:#a5b4fc;
  border-bottom:1px solid #374151;
  padding-bottom:6px;
}

input, select, textarea{
  border-radius:10px;
  border:1px solid #374151;
  padding:8px;
  background:#020617;
  color:#e5e7eb;
  width:100%;
}

textarea{ min-height:70px; }

.imagem-box{
  border:2px dashed #4b5563;
  border-radius:12px;
  padding:12px;
  text-align:center;
  cursor:pointer;
}

.imagem-box img{
  max-width:60%;
  border-radius:10px;
  margin-top:10px;
}

/* atributos/per√≠cias */
.atributo, .pericia{
  display:grid;
  grid-template-columns: 1fr 80px 40px 150px;
  align-items:center;
  gap:10px;
  margin:6px 0;
}

.dice{ cursor:pointer; text-align:center; font-size:20px; }
.resultado{ color:#a5f3fc; font-size:13px; }

/* status */
.status-card{ display:grid; grid-template-columns:1fr 1fr; gap:14px; }
.status-item{ background:#020617; border:1px solid #374151; padding:10px; border-radius:12px; }
.status-top{ display:flex; justify-content:space-between; }
.status-bar{ height:8px; background:#1f2937; border-radius:10px; overflow:hidden; margin-top:6px; }
.status-fill{ height:8px; background:linear-gradient(90deg,#4ade80,#22c55e); width:100%; transition:.25s; }
.status-fill.sanity{ background:linear-gradient(90deg,#60a5fa,#3b82f6); }

/* ataques */
.ataque-box{
  background:#020617;
  border:1px solid #374151;
  padding:10px;
  border-radius:10px;
  margin:8px 0;
}

.add-btn, .salvar-btn{
  padding:8px 14px;
  border-radius:10px;
  border:none;
  background:#4f46e5;
  color:white;
  cursor:pointer;
  margin-top:8px;
}

</style>
</head>

<body>

<header>Ficha RPG</header>

<div class="tabs">
  <button class="tab-btn active" onclick="abrirTab('basico')">B√°sico</button>
  <button class="tab-btn" onclick="abrirTab('atributosTab')">Atributos</button>
  <button class="tab-btn" onclick="abrirTab('periciasTab')">Per√≠cias</button>
  <button class="tab-btn" onclick="abrirTab('statusTab')">Status</button>
  <button class="tab-btn" onclick="abrirTab('habilidadesTab')">Habilidades</button>
  <button class="tab-btn" onclick="abrirTab('ataquesTab')">Ataques</button>
</div>

<div id="ficha">

<!-- ===================== B√ÅSICO ===================== -->
<section id="basico" class="section active">

  <div class="bloco">
    <h2>Imagem do Personagem</h2>
    <div class="imagem-box" onclick="document.getElementById('imagemInput').click()">
      Clique para adicionar imagem
      <input type="file" id="imagemInput" accept="image/*" style="display:none">
      <img id="previewImg">
    </div>
  </div>

  <div class="bloco">
    <h2>Informa√ß√µes</h2>

    <label>Nome</label>
    <input id="nome">

    <label>Idade</label>
    <input id="idade" type="number">

    <label>Energia Interna</label>
    <textarea id="antecedencia"></textarea>

    <label>Descri√ß√£o</label>
    <textarea id="descricao"></textarea>

    <label>Hist√≥ria</label>
    <textarea id="historia"></textarea>
  </div>

</section>

<!-- ===================== ATRIBUTOS ===================== -->
<section id="atributosTab" class="section">
  <div class="bloco">
    <h2>Atributos</h2>
    <div id="atributos"></div>
  </div>
</section>

<!-- ===================== PER√çCIAS ===================== -->
<section id="periciasTab" class="section">
  <div class="bloco">
    <h2>Per√≠cias</h2>
    <div id="pericias"></div>
  </div>
</section>

<!-- ===================== STATUS ===================== -->
<section id="statusTab" class="section">
  <div class="bloco">
    <h2>Status</h2>

    <div class="status-card">
      <div class="status-item">
        <div class="status-top">
          <div>Vida</div><span>‚ù§Ô∏è</span>
        </div>
        <input id="vida" type="number" value="100" oninput="atualizarBarra('vida','vida-bar')">
        <div class="status-bar"><div id="vida-bar" class="status-fill"></div></div>
      </div>

      <div class="status-item">
        <div class="status-top">
          <div>Sanidade</div><span>üß†</span>
        </div>
        <input id="sanidade" type="number" value="100" oninput="atualizarBarra('sanidade','sanidade-bar')">
        <div class="status-bar"><div id="sanidade-bar" class="status-fill sanity"></div></div>
      </div>
    </div>
  </div>
</section>

<!-- ===================== HABILIDADES ===================== -->
<section id="habilidadesTab" class="section">
  <div class="bloco">
    <h2>Habilidades</h2>
    <textarea id="habilidades" placeholder="Descreva as habilidades do personagem..."></textarea>
  </div>
</section>

<!-- ===================== ATAQUES ===================== -->
<section id="ataquesTab" class="section">
  <div class="bloco">
    <h2>Ataques</h2>

    <div id="listaAtaques"></div>

    <button class="add-btn" onclick="addAtaque()">Adicionar Ataque</button>
  </div>
</section>

</div>

<script>
/* ---------- abas ---------- */
function abrirTab(id){
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");

  document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
  event.target.classList.add("active");
}

/* ---------- dados ---------- */
function d20(){ return Math.floor(Math.random()*20)+1; }

/* ---------- atributos ---------- */
const atributos = [
  {sigla:"FOR", nome:"For√ßa"},
  {sigla:"CON", nome:"Constitui√ß√£o"},
  {sigla:"AGI", nome:"Agilidade"},
  {sigla:"INT", nome:"Intelecto"},
  {sigla:"POD", nome:"Poder"}
];

const pericias = [
  ["FOR","Atletismo"],
  ["FOR","Luta"],
  ["CON","Fortitude"],
  ["AGI","Reflexos"],
  ["AGI","Furtividade"],
  ["AGI","Acrobacia"],
  ["AGI","Iniciativa"],
  ["AGI","Pontaria"],
  ["AGI","Pilotagem"],
  ["INT","Ci√™ncias"],
  ["INT","T√°tica"],
  ["INT","Investiga√ß√£o"],
  ["INT","Medicina"],
  ["INT","Tecnologia"],
  ["INT","Sobreviv√™ncia"],
  ["INT","L√°bia"],
  ["INT","Diplomacia"],
  ["POD","Intimida√ß√£o"],
  ["INT","Artes"],
  ["POD","Intui√ß√£o"],
  ["POD","Percep√ß√£o"],
  ["INT","Adestramento"],
  ["POD","Charme"],
  ["POD","Vontade"]
];

function criarInterface(){
  const aBox = document.getElementById("atributos");
  atributos.forEach(a=>{
    aBox.innerHTML += `
      <div class="atributo">
        <div>[${a.sigla}] ${a.nome}</div>
        <select id="atr_${a.sigla}">
          ${[...Array(11).keys()].map(v=>`<option>${v}</option>`).join("")}
        </select>
        <span class="dice" onclick="rolarAtributo('${a.sigla}')">üé≤</span>
        <span id="resAtr_${a.sigla}" class="resultado"></span>
      </div>`;
  });

  const pBox = document.getElementById("pericias");
  pericias.forEach((p,i)=>{
    const id = "per_"+i;
    pBox.innerHTML += `
      <div class="pericia">
        <div>[${p[0]}] ${p[1]}</div>
        <select id="${id}">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
        </select>
        <span class="dice" onclick="rolarPericia('${id}','${p[0]}')">üé≤</span>
        <span id="res_${id}" class="resultado"></span>
      </div>`;
  });
}
criarInterface();

function rolarAtributo(sigla){
  const v = Number(document.getElementById("atr_"+sigla).value);
  document.getElementById("resAtr_"+sigla).innerText = "Resultado: " + (d20()+v);
}

function rolarPericia(id, sigla){
  const per = Number(document.getElementById(id).value);
  const atr = Number(document.getElementById("atr_" + sigla).value);
  const bonus = atr;

  const d1 = d20(), d2 = d20(), d3 = d20();
  let resultado, texto;

  if (per === 1){
    resultado = d1 + bonus;
    texto = `1d20 (${d1}) + ${bonus} = ${resultado}`;
  } else if (per === 2){
    const maior = Math.max(d1, d2);
    resultado = maior + bonus;
    texto = `2d20 (${d1} | ${d2}) ‚Üí ${maior} + ${bonus} = ${resultado}`;
  } else {
    const maior = Math.max(d1, d2, d3);
    resultado = maior + bonus;
    texto = `3d20 (${d1} | ${d2} | ${d3}) ‚Üí ${maior} + ${bonus} = ${resultado}`;
  }

  const span = document.getElementById("res_" + id);
  span.innerText = texto;

  setTimeout(()=> span.innerText = "", 6000);
}

/* ---------- imagem ---------- */
document.getElementById("imagemInput").addEventListener("change", e=>{
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = ()=> document.getElementById("previewImg").src = reader.result;
  reader.readAsDataURL(file);
});

/* ---------- status ---------- */
function atualizarBarra(inputId, barId){
  const v = Math.min(100, Math.max(1, parseInt(document.getElementById(inputId).value)||1));
  document.getElementById(barId).style.width = v+"%";
}
atualizarBarra("vida","vida-bar");
atualizarBarra("sanidade","sanidade-bar");

/* ---------- ataques ---------- */
function addAtaque(){
  const box = document.createElement("div");
  box.className = "ataque-box";

  box.innerHTML = `
    <label>Nome do ataque</label>
    <input class="atk-nome">

    <label>Dado de dano (ex: 1d6, 2d8)</label>
    <input class="atk-dado">

    <label>Cr√≠tico</label>
    <input class="atk-critico" placeholder="ex: 19/x3">

    <label>Descri√ß√£o</label>
    <textarea class="atk-desc" placeholder="Explique o ataque..."></textarea>

    <button class="add-btn" onclick="rolarAtaque(this)">üé≤ Rolar</button>
    <div class="resultado"></div>
  `;

  document.getElementById("listaAtaques").appendChild(box);
}

function rolarAtaque(btn){
  const box = btn.parentElement;
  const dado = box.querySelector(".atk-dado").value.trim();

  if(!dado.includes("d")) return;

  const [n,s] = dado.split("d").map(Number);
  let total = 0;
  let rolls = [];

  for(let i=0;i<n;i++){
    const r = Math.floor(Math.random()*s)+1;
    total += r;
    rolls.push(r);
  }

  box.querySelector(".resultado").innerText =
    `${dado} ‚Üí (${rolls.join(" | ")}) = ${total}`;
}
</script>

</body>
</html>
